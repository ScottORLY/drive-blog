!function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/drive-blog",i(i.s=3)}([function(e,t,i){"use strict";(function(e){var o=i(1),n=i.n(o);t.a=function(t){var i=t.attributes.url,o=e("div",{className:n.a.gist});var r="callback".concat(Math.floor(Math.random()*Math.floor(1e5)));window[r]=function(t){var i=e("link",{rel:"stylesheet",href:t.stylesheet});document.body.appendChild(i),o.innerHTML=t.div};var a=document.createElement("script");return a.setAttribute("src","".concat(i,"&callback=").concat(r)),document.body.appendChild(a),o}}).call(this,i(2).h)},function(e,t,i){e.exports={app:"app__1hgMo",img:"img__2eUsJ",gist:"gist__11fu1",noIndent:"noIndent__2mYg_",right:"right__1_mIR",inlineCode:"inlineCode__2dlzF",list:"list__DN-zw"}},function(e,t,i){"use strict";i.r(t),i.d(t,"h",(function(){return s})),i.d(t,"f",(function(){return l}));const o="http://www.w3.org/1999/xhtml",n="http://www.w3.org/2000/svg",r=["animate","animateMotion","animateTransform","audio","canvas","circle","clipPath","defs","desc","discard","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","foreignObject","g","iframe","image","line","linearGradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tspan","unknown","use","video","view"];var a=e=>-1==r.indexOf(e)?o:n;const s=(e,t,...i)=>{try{const o=i.length?[].concat(...i):[];if(null==t&&(t={}),"function"==typeof e)return e({attributes:t,children:o});const n=t.xmlns||a(e),r=document.createElementNS(n,e);if(!Object.keys(t).length&&null==o)return r;o.forEach(e=>{"string"==typeof e?r.appendChild(document.createTextNode(e)):e instanceof Array==!0?e.forEach(e=>r.appendChild(e)):r.appendChild(e)});for(const e in t){const i=t[e];void 0!==i&&"xmlns"!==e&&("className"!==e?"eventListener"!==e?"eventListeners"!==e?r.setAttribute(e,i):i.forEach(e=>r.addEventListener(...e)):r.addEventListener(...i):i.split(" ").forEach(e=>r.classList.add(e)))}return r}catch(e){console.log(e)}},l=({children:e})=>{try{const t=document.createDocumentFragment();return e.forEach(e=>{e instanceof Array==!0?e.forEach(e=>t.appendChild(e)):"string"==typeof e?t.appendChild(document.createTextNode(e)):t.appendChild(e)}),t}catch(e){console.log(e)}}},function(e,t,i){e.exports=i(4)},function(e,t,i){"use strict";i.r(t),function(e){var t=i(1),o=i.n(t),n=i(0),r=function(t){var i=t.attributes.code;return e("pre",{className:o.a.inlineCode},i)},a="https://gist.github.com/ScottORLY/49dcd868fa0127b9db5a8ff40e14d9b8.json?file=",s=e("div",{id:o.a.app},e("h1",null,e("i",null,"Drive")),e("h2",null,"Functional Reactive Form Validation in iOS with RxSwift"),e("h4",null,"by ",e("a",{href:"https://github.com/ScottORLY"},"Scott Orlyck")),e("img",{className:o.a.img,src:"https://raw.githubusercontent.com/ScottORLY/drive-blog/main/src/drive.jpg",alt:"Ryan Gosling with a Dispose Bag"}),e("p",null,e("a",{href:"https://www.youtube.com/watch?v=KBiOF3y1W0Y"},e("i",null,"Drive, 2011"))),e("h2",null,"Introduction"),e("p",null,"This blog post is intended for readers with some measure of familiarity with iOS development, functional reactive programming and alternative iOS architecture patterns. If not here are some resources to get started.",e("ul",{className:o.a.list},e("li",null,e("a",{href:"http://reactivex.io/"},"ReactiveX")),e("li",null,e("a",{href:"https://github.com/ReactiveX/RxSwift"},"RxSwift")),e("li",null,e("a",{href:"https://www.raywenderlich.com/34-design-patterns-by-tutorials-mvvm"},"MVVM")))),e("h2",null,"Why Drive?"),e("p",null,"SwiftUI has been getting all the love since it was announced but I want to take some time to write about the productivity benefits of functional reactive programming using RxSwift when combined with the stability of UIKit."),e("p",null,"Observables are excellent for escaping target-action, delegate based MVC patterns but even after the steep learning curve remembering tedious boilerplate and dodging footguns can be time consuming and error prone. Furthermore type inference across API boundaries can result in frustrating fights with the Swift compiler."),e("p",null,"An example from the RxSwift documentation is an effective demonstration of the implementation complexity faced when using Rx with UIKit."),e(n.a,{url:"".concat(a,"subscribe.swift")}),e("p",null,"Thankfully RxSwift provides us with some wrappers around common RxSwift UI patterns that can help simplify implementations. RxSwift calls these wrappers ",e("a",{hre:""},"traits")," and today we are going to focus on the ",e("a",{href:"https://github.com/ReactiveX/RxSwift/blob/main/Documentation/Traits.md#driver"},"Driver")," trait."),e("p",null,"RxSwift Traits are simple structs that implement the builder pattern to return an observable sequence guaranteed to have certain properties. The Driver trait guarantees three properties that happen to be integral to correct UI implementations: events are observed on the main thread, the observable sequence can't error out, and side effects are shared so that each subscription will share the same computational resources."),e(n.a,{url:"".concat(a,"RxDrive.swift")}),e("p",{className:o.a.noIndent},"Let's take a closer look at a practical example."),e("h2",null,"Real Time UITextfield Validation"),e("div",null,e("img",{className:"".concat(o.a.img," ").concat(o.a.right),src:"https://raw.githubusercontent.com/ScottORLY/drive-blog/main/src/validation.gif"}),e("div",null,e("p",null,"Form validation that provides the user with immediate feedback if a text field meets predefined requirements is a common UX pattern and this example will show you how you can use the Driver trait for effective results with a very small amount of clean, testable code."),e("p",null,"For the purpose of narrowing the focus of this article I won't be going over project setup, how to connect outlets in storyboards, the basics of RxSwift/RxCocoa etc. I will also be handwaving the networking, validation and network activity tracking utilities as those implementation details are outside the scope of this article. The working project source code is available ",e("a",{href:"https://github.com/ScottORLY/drive"},"here")," if you would like to take a closer look or test a working example on a simulator or device."))),e("p",null,"This project will use MVVM but there are a few ground rules to help enforce seperation of concerns:",e("ol",{type:"1",className:o.a.list},e("li",null,"The ViewModel can never import UIKit or reference the ViewController."),e("li",null,"The ViewModel will never subscribe to an observable."),e("li",null,"The ViewController will never directly call any methods defined on the ViewModel."))),e("p",null,"First we define inputs to the ViewModel. The initializer for our new ViewModel class below takes a pair of ",e(r,{code:"Driver<String>"})," for the email and password and a ",e(r,{code:"Driver<Void>"})," for the sign in button tap. We are not going to explicitly store references to these sequences."),e(n.a,{url:"".concat(a,"init.swift")}),e("p",null,"In the ViewController we initialize the ViewModel passing in the Observables from the IBOutlets. Note the call to ",e(r,{code:".asDriver()"})," to build the Drivers from the ControlEvent observables."),e(n.a,{url:"".concat(a,"outlets.swift")}),e("p",null,"Next we define output properties to store the reference to the result of the operator transformations we are going to perform on the input observables."),e(n.a,{url:"".concat(a,"outputs.swift")}),e("p",null,"Above we are using ",e(r,{code:"Driver.combineLatest"})," to combine events from the UITextField Drivers and the sign in button tap. The purpose of this is to exploit a behavior of combine latest that the result observable will not emit an event until both source observables have at least one in order to prevent displaying validation errors before user interaction. Then we ",e(r,{code:".flatMapLatest"})," the combined text and tap events passing the string into our validation service's appropriate validation method and return a ",e(r,{code:"Driver<Validation>"})," that is stored in the output properties defined above."),e("p",null,"Close the loop by calling ",e(r,{code:"drive(onNext:)"})," on the output observables in the ViewController. Don't forget to put the results of the ",e(r,{code:"drive(onNext:)"})," calls in the ",e(r,{code:"bag"})," or to call ",e(r,{code:"bind()"})," in ",e(r,{code:"viewDidLoad()"}),"."),e(n.a,{url:"".concat(a,"bind.swift")}),e("h2",null,"The Getaway"),e("p",null,"Add two more output properties to the ViewModel. The first is ",e(r,{code:"signingIn: Driver<Bool>"})," to manage the state of the current request so we can disable the sign in button when a request is in-flight. The second is the output Driver for the response from the network request to sign in."),e(n.a,{url:"".concat(a,"outputs1.swift")}),e("p",null,"The ViewModel snippet below is preparation to handle the sign in implementation. Compose the email and password text drivers (the inputs) with the validation result drivers (the outputs) in addition we create another Driver wrapped observable from a utility class borrowed from RxExample that provides the ability to track the activity of an observable so we can prevent the user from creating a duplicate request if one is already in-flight and the user mashes the sign in button."),e(n.a,{url:"".concat(a,"combine.swift")}),e("p",null,"Finally we hook everything together, there is a lot going on here so let's break it down line by line. First call ",e(r,{code:"withLatestFrom()"})," with the combined inputs and outputs composed above (",e(r,{code:"validated"}),"). Then we ",e(r,{code:"flatMapLatest"})," the observables composition, guard for successful validation and no requests in flight, then flatMap the observable from the network sign in request, check the response status (the example code is oversimplifed but in a real world application here is where you determine error messsages to display if for instance the response was ",e("i",null,"401 unauthorized"),") and return an ",e(r,{code:"Observable<LoginResponse>"}),", add the activity tracking and finally build the ",e(r,{code:"signedIn: Driver<LoginResponse>"})," output Driver."),e(n.a,{url:"".concat(a,"signedin.swift")}),e("p",null,"Now in the ViewController we use ",e(r,{code:"drive(onNext:)"})," to drive the state of the ",e(r,{code:"isEnabled"})," property of the sign in button and drive ",e(r,{code:"signedIn"})," to handle the result of the sign in network call. Again taking caution to use ",e(r,{code:"[weak self]"})," and don't forget to dispose of the result of ",e(r,{code:"drive"})," in the bag."),e(n.a,{url:"".concat(a,"bind1.swift")}),e("p",null,"The success state is where the application would presumbaly handle navigating elsewhere or dismissing the sign in in screen if presented modally. In a real world application the response should wrap a more informative error message that can then be displayed to the user  ."),e("h2",null,"Test Drive"),e("p",null,"What about unit testing the ViewModel you ask? Simple, since all the ViewModel knows is that it needs 3 Drivers we can provide those easily."),e(n.a,{url:"".concat(a,"TestDrive.swift")}),e("h2",null,"In the Bag"),e("p",null,"That's the post, you can find the completed working project ",e("a",{href:"https://github.com/ScottORLY/drive"},"here"),". Feel free to drop some feedback or questions on ",e("a",{href:"https://twitter.com/orlyck"},"Twitter")," or you can go to the ",e("a",{href:"https://github.com/ScottORLY/drive-blog"},"source")," of this blog post itself and create an issue or pull-request. Until next time."));document.body.appendChild(s)}.call(this,i(2).h)}]);